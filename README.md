# Auxiliary task demands mask the capabilities of smaller language models

This repository contains code and data for the paper "Auxiliary task demands mask the capabilities of smaller language models".

The files are structured as follows:

- `configs`: YAML files used to control experiment settings
- `external_stimuli`: CSV files containing stimuli from external datasets
- `figures`: rendered figures from paper
- `notebooks`: Jupyter notebooks for all analyses and reproducing figures
- `output`: CSV files with outputs from model runs
- `src`: Python scripts for implementing the experiments

## Config files

Config files were generated by running the script `python configs/make_configs.py`. You can customize it for your own purposes if you want to add models or tasks.

Config files are named with the convention `configs/<TASK>/<MODEL>.yaml`. When there are subconditions (as is the case for the reflective reasoning `crt` task), then the files are named `configs/<TASK>/<CONDITION>/<MODEL>.yaml`.

## Running an experiment

The main controller script is `src/run_experiment.py`. It can take either a YAML config file (see the `configs` folder for examples) or standard Python command-line arguments.

1. Example usage with config file:
```bash
python src/run_experiment.py -c configs/digit_mat/gemma-2b.yaml
```

2. Example usage with command-line arguments:
```bash
python src/run_experiment.py \
    --model mistralai/Mistral-7B-v0.1 \
    --task crt \
    --condition crt2
```
Note that the `model` argument takes the Huggingface model identifier, but output files are saved without the initial organization name (e.g., "Mistral-7B-v0.1") for file-naming purposes.

3. Example usage with large model (>7B parameters) requiring `accelerate` (you will need to request multiple GPUs; YMMV on your hardware):
```bash
python src/run_experiment.py \
    --model meta-llama/Llama-2-70b-hf \
    --accelerate \
    --task blimp
```

4. Example usage with OLMo training steps ("revisions"):
```bash
python src/run_experiment.py \
    --model allenai/OLMo-7B \
    --task lambada \
    --revision step10000-tokens44B
```
The full list of available revisions is available at [https://huggingface.co/allenai/OLMo-7B/blob/main/revisions.txt](https://huggingface.co/allenai/OLMo-7B/blob/main/revisions.txt).
